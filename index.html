<!DOCTYPE html>
<html>
<head>
	 <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="index.css" type="text/css"/>
	 <title>MemeMaster Login</title>
  <style>
  
  </style>
</head>
	<body onload="memeresize('memes')" onresize="memeresize('memes')">
    <div id="blackout" style="display:none;z-index:300;position:fixed;width:100%;height:100%;background-color:rgba(0,0,0,0.4);"></div>
		<div id="header-container"><div class="heading"><header class="login">
      <div class="header-logo"><img src="logo4.png" alt="MemeMaster" ></div>
    
    
    <div class="search-login"><form method="get" name="search" action="searchpage.html">
    <input class="search" type="text" name="globalq" placeholder="Search for something funny...">
      
      </form></div></header></div></div>
    
    <div class="landing-container"> 
    <div class="landing">
      
	  <section class="login" id="memes">
      <header class="trending"><article class="trending"><h2 class="trending">What's Trending on MemeMaster</h2></article>
        <aside class="trending"><div class="menu"><ul class="trending"><li id="nsfw-filter"><label id="NSFW-label">NSFW Filter:</label><div class="nsfw">	
	<input type="checkbox" value="None" id="nsfw" name="check" checked>
	<label for="nsfw"></label>
          </div></li><li style="margin: 4px 4px 0 3px; padding:0;">Showing:</li>
          <li class="trending-menu menu-arrow submenu-entry" id="sorting-name">Most Popular</li></ul>
          <ul class="submenu">
            <li id="pop-sort" onclick="galleryObj.sortType(0);">Most Popular</li>
            <li id="unpop-sort" onclick="galleryObj.sortType(1);">Least Popular</li>
            <li id="old-sort" onclick="galleryObj.sortType(2);">Newest</li>
            <li id="new-sort" onclick="galleryObj.sortType(3);">Oldest</li>
          </ul></div>
          </aside>
      </header>
     <div class="img-trending" id="memes-trending-landing">   
       <!--
          <article class="meme" data-entry-id="seal">
          <header class="meme-head">
              <h4>
                <a href ="memepage.html">Hanging out with my friend and...</a>
              </h4>
          </header>
            <div class="meme-img">
          <a href="memepage.html">
              <img class="meme" src="http://placehold.it/230x230" alt="Hanging out with my friend and his brother in law whom I've never met"></a></div>
          <time datetime="2014-07-11"></time>
          
        </article>
        <article class="meme" data-entry-id="s2">
          <header class="meme-head">
              <h4>
                <a href ="memepage.html">Hanging out with my friend and...</a>
              </h4>
          </header>
            <div class="meme-img">
          <a href="memepage.html">
              <img class="meme" src="http://placehold.it/230x230" alt="placeholder2"></a></div>
          <time datetime="2014-07-11"></time>
          
        </article>
        <article class="meme" data-entry-id="s3">
          <header class="meme-head">
              <h4>
                <a href ="memepage.html">Hanging out with my friend and...</a>
              </h4>
          </header>
            <div class="meme-img">
          <a href="memepage.html">
              <img class="meme" src="http://placehold.it/230x230" alt="placeholder3"></a></div>
          <time datetime="2014-07-11"></time>
          
        </article>
        <article class="meme" data-entry-id="s4">
          <header class="meme-head">
              <h4>
                <a href ="memepage.html">Hanging out with my friend and...</a>
              </h4>
          </header>
            <div class="meme-img">
          <a href="memepage.html">
              <img class="meme" src="http://placehold.it/230x230" alt="placeholder4"></a></div>
          <time datetime="2014-07-11"></time>
          
        </article>
    -->
   </div>
      </section><aside class="login" style="display:none;">
      <header class="login-container"><h3>Sign In</h3></header>
      <div class="error" style="display:none"></div>
	  <div class="login-container"><form id="login-form">
      <input type="text" id="login-username" placeholder="username" required="required"><br>
      <input type="password" id="login-password" placeholder="password" required="required">
      <br>
      <label>Keep me logged in</label>  
	      <input type="checkbox" name="saveuser">
      
	    <input type="submit" value="Login" >
      <br>
    </form>
    
	  <a class="loginhelp" href="#">Forgot Password</a>
    <br>
    
    <a class="loginhelp" href="#" id="signup-modal-show">Sign-Up</a><br></div></aside>
      
    
      
      </div>
    </div>
    <footer id="common-footer">
      <div id="footer-left"><ul class="footer">
        <li class="footer"><a href="#" class="footer">About This Site</a></li>
        <li class="footer"><a href="#" class="footer">Privacy Policy</a></li>
        <li class="footer"><a href="team/index.html" class="footer">Team Page</a></li>
        </ul></div>
    
      </footer>
    
    <!-- Signup Modal -->
    <div id="signup-modal">
      <div style="display:inline-block;margin: 0 0 8px 0;">
      <section class="signup-modal-heading">
        <h3>Sign-Up</h3>
      </section>
      <aside class="signup-modal-heading">
        <div class="signup-modal-close modal-close"></div>
      </aside>
      </div>
      
      <form id="suform">
        <section class="signup-modal-landing">
          <label for="signup-name">Username:</label><input type="text" id="signup-name" class="signup" placeholder="username" required>
        <br>
        <label for="signup-pass" style="padding-right:2px;">Password:</label><input type="password" id="signup-pass" class="signup" placeholder="password" required>
      </section>
       <footer class="signup-modal-footer">
        <section class="signup-modal-footer">
          <button class="signup-modal-close" type="button">Cancel</button>
          <input type="submit" value="Sign Up &raquo;">
        </section>
      </footer>
        </form>
    </div> 
    <!-- SignUp Modal End-->
    
    
    <!-- Upload Modal -->
  <div id="upload-modal">
      <div style="display:inline-block;margin: 0 0 8px 0;">
      <section class="upload-modal-heading">
        <ul class="upload-modal">
          <li id="upload-modal-local-option" class="upload-modal-menu upload-modal-menu-selected">
            <a class="upload-modal" href="#">From Your Computer</a>
          </li>
          <li id="upload-modal-web-option" class="upload-modal-menu">
            <a class="upload-modal" href="#">From the Web</a>
          </li>
          
        </ul>
      </section>
      
      <aside class="upload-modal-heading">
        <div class="upload-modal-close modal-close"></div>
      </aside>
      </div>
      
      <section id="upload-modal-file-landing" class="upload-modal-file-landing">
        <article class="upload-modal-file-landing">
          <button id="upload-modal-browse" type="button">Browse</button><input type="file" id="input-upload-modal-browse"  accept="image/*" multiple>
        </article>
        <aside class="upload-modal-file-landing" id="upload-modal-drag-drop">
          Drag and Drop
        </aside>
      </section>
    
    <section id="upload-modal-url-landing" class="upload-modal-url-landing" style="display:none;">
        <article class="upload-modal-url-landing">
          <textarea class="url-entry" cols="30" rows="5" id="url-entry" placeholder="Enter in URL's separated by newlines"></textarea>
        </article>
      </section>
    
      <section class="upload-modal-option">
        <label for="upload-modal-gallery-option" style="margin:6px;float:right;">Gallery</label>
        <input type="checkbox" id="upload-modal-gallery-option" style="vertical-align:top;margin:8px 0 0 8px;float:right;">
         <input type="text" class="upload-modal-gallery-title" id="upload-modal-gallery-title" style="float:right;" placeholder="Gallery Title">
         
         
      </section>
      <section id="upload-modal-files-container" class="upload-modal-files-container">
        
        
        
        
        
      </section>
      <footer class="upload-modal-footer">
        <section class="upload-modal-footer">
          <button class="upload-modal-close" type="button">Cancel</button>
          <button id="upload-modal-done" type="button">Upload &raquo;</button>
        </section>
      </footer>
      

    </div>
    <!-- End Upload Modal -->
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="//www.parsecdn.com/js/parse-1.2.19.min.js"></script>
    <script src="init.js"></script>
    <script src="uploader.js"></script>
    <script>
      if(Parse.User.current()){
        $("#nsfw-filter").show();
      }
    /* Modal display */
    $(function() {  
      $("#signup-modal-show").click(function() { 
          document.getElementById("signup-modal").style.top = window.innerHeight/2 - 270 + 'px';
          document.getElementById("signup-modal").style.left = window.innerWidth/2 - 200 + 'px';
          $("#signup-modal").slideDown(400);
          $("#blackout").fadeIn(700);
      });  
    });
      
    $(function() {  
      $(".signup-modal-close").click(function() {  
          $("#signup-modal").slideUp(400);  
          $("#blackout").fadeOut(700);
      });  
    });
      
    $(function() {  
      $("#blackout").click(function() {  
          $("#signup-modal").slideUp(400);  
          $("#blackout").fadeOut(700);
      });  
    }); 
   $("#nsfw").change(function(){
     galleryObj.nsfwSearch(this.checked);
   });
    
    function memeresize(target) {
    var boxsz = 259;
    var offset = 275;
    var width = Math.floor((window.innerWidth-offset)/boxsz);
      document.getElementById(target).style.maxWidth=(width*boxsz)+"px";
      
    }
      function changeHeader(){
        var body ="";
        body = "<header class=\"nav-container\">\
      <div class=\"logo-container\">\
        <a href=\"./\"><img src=\"logo4.png\" alt=\"MemeMaster\" class=\"logo-img\"></a></div>\
      <nav class=\"nav-head\"><ul class=\"navglobal\">\
          <li class=\"navmenu\"><a class=\"navmenu\" href=\"home.html\">Home</a></li>\
          <li class=\"navmenu\"><a class=\"navmenu\" id=\"upload-modal-show\" href=\"#\">Upload</a></li>\
          <li class=\"navmenu\"><a class=\"navmenu\" href=\"creatememe.html\">Create</a></li>\
          <li class=\"navmenu\"><a class=\"navmenu\" href=\"#\">Help</a></li>\
          <li class=\"nav-search\"><div class=\"search-container\"><form method=\"get\" name=\"search\"\ action=\"searchpage.html\">\
          <input class=\"search\" type=\"text\" name=\"globalq\" placeholder=\"Search\"></form></div></li>\
        </ul>\
        </nav>\
      <div id=\"user-container\" class=\"nav-user-container\">\
        <article class=\"nav-user-welcome\" id=\"welcome-message\"></article>\
       <aside class=\"nav-userpic stretch-container\" id=\"userimg\"></aside></div>\
    </header>";
    return body;
      }
      
    $( "#suform" ).submit(function signUpSubmit(event) {
        var username = document.getElementById("signup-name").value;
        var password = document.getElementById("signup-pass").value;
        signUp(username, password);
        event.preventDefault();
      });
      
      
    function signUp(username, password){
      var user = new Parse.User();
       user.set("username", username);
       user.set("password", password);
      
       user.signUp(null, {

        
          success: function(user) {
            
            // Hooray! Let them use the app now.
            
            location.href="home.html";
          },
          error: function(user, error) {
            // Show the error message somewhere and let the user try again.
            alert("Error: " + error.code + " " + error.message);
          }
        });
    }
    
    $( "#login-form" ).submit(function login_submit(event) {
      var username = document.getElementById("login-username").value;
      var password = document.getElementById("login-password").value;
      Parse.User.logIn(username, password, {
        success: function(user) {
          
          
          location.href="home.html";
        },
        error: function(user, error) {
          document.getElementById("login-password").value = "";
          alert(error.message);
        }
      });
  event.preventDefault();
  });
    
     
    var currentUser = Parse.User.current();
    if (currentUser) {
    $("aside.login").hide();
      $("#header-container").html(changeHeader());
      welcome_message(Parse.User.current());
    //Parse.User.logOut();
    }
    else{
      
      $("aside.login").show();
    }


    </script>
    
    <script>
      var galleryObj = new galleryQuery();
      
    galleryObj.sendQuery(40, 0);
    // Initializing our events
    var queryComplete = document.createEvent('Event');
    queryComplete.initEvent('queryComplete', true, true);
      var newContentCounter = 0;
      var noNewContent = false;
      $(window).scroll(function() {
         if(($(window).scrollTop() + $(window).height() > $(document).height() - 100) && !noNewContent && galleryObj.coverPic.length > 0) {
           noNewContent = true;
           galleryObj.coverPic.length = 0;
           newContentCounter += 40;
           galleryObj.sendQuery(40, newContentCounter);
           
         }
      });
      
      function trendingEntry(title, id, cover, date, total_likes, likes){
        var shortTitle =title;
        if (title.length > 25)
          shortTitle = title.substring(0,25) + "...";
        var text="<article class=\"meme\">\
          <header class=\"meme-head\">\
              <h4>\
                <a href=\"memepage.html?gal="+id+"\">"+shortTitle+"</a>\
              </h4>\
          </header>\
            <div class=\"meme-img stretch-container\">\
          <a href=\"memepage.html?gal="+id+"\">\
              <img class=\"meme\" src=\""+cover+"\" alt=\""+title+"\"></a></div>\
            <div class=\"progress-flex\"><progress class=\"meme-rating\" id=\"meme-rating\" \
            max=\""+total_likes+"\" value=\""+likes+"\"></progress></div>\
          <time datetime=\""+date+"\"></time>\
        </article>";
        return text;
      }
      function displayResult(title,id, cover, date,total_likes,likes){
  //alert(title+ " "+cover+ " "+likes+ " "+total_likes+ " "+id+ " "+date);
  var shortTitle = title;
  if (title.length > 25)
    shortTitle = title.substring(0,25) +"...";
  var body="<article class=\"meme\" title=\""+title+"\"><header class=\"meme-head\"><h4><a href =\"memepage.html?gal="+id+"\">" + shortTitle +"</a></h4></header><div class=\"meme-img stretch-container\"><a href =\"memepage.html?gal="+id+"\"><img class=\"meme\" src=\""+ cover +"\" alt=\""+title+"\"></a></div><br><time datetime=\"" +date+ "\"></time><progress max=\""+total_likes+"\" value=\""+likes+"\"></progress></article>";
 // alert(body);
  return body; 
}
      document.addEventListener('queryComplete',
                                function(){
                                  var body =""
                                  for (var i=0; i < galleryObj.coverPic.length; i++){
                                   // if (galleryObj.public[i] && !galleryObj.nsfw[i]) {
                                    body += displayResult(galleryObj.title[i], galleryObj.myId[i], galleryObj.coverPic[i], galleryObj.date[i], galleryObj.total_likes[i], galleryObj.likes[i]);
                                //    }
                                  }
                                  
                                  if (galleryObj.coverPic.length == 0) {
                                    body ="<div style=\"width:100%;order:100;margin-top:20px;text-align:center;\"><h2>End of new content</h2></div>";
                                    newContentCounter -= 40;
                                    noNewContent = true;
                                  }
                                  else
                                    noNewContent = false;
                                  if (!galleryObj.flushBody)
                                    document.getElementById("memes-trending-landing").innerHTML += body;
                                  else {
                                    document.getElementById("memes-trending-landing").innerHTML = body;
                                    galleryObj.flushBody = false;
                                  }
                                  stretchContainers();
                                  
                                  $("div.landing-container").slideDown(200);
                                  $("div.landing-container").css("display", "flex");
                                });
/* ---------------------------- */    
    /* ---------------------------- */
    /* --- Gallery Query Object --- */
    /* ---------------------------- */
    /* ---------------------------- */
 
    function galleryQuery(){
      this.coverPic=[""];
      this.public = [true];
      this.images = [];
      this.myId=[""];
      this.nsfw=[false];
      this.nsfwFilter=true;
      this.sortType = function(val){
        this.coverPic.length = 0;
        this.SortType = val;
        var plain = ["Most Popular", "Least Popular", "Newest", "Oldest"];
        $("#sorting-name").html(plain[val]);
        this.flushBody = true;
        this.sendQuery(40+newContentCounter,0);
      }
      this.nsfwSearch = function(nsfw){
        this.coverPic.length = 0;
        this.nsfwFilter = nsfw;
        this.flushBody = true;
        this.sendQuery(40+newContentCounter,0);
      }
      this.SortType = 0;
      this.flushBody = false;
      this.title=[""];
      this.user=[];
      this.tags=[""];
      this.likes=[0];
      this.total_likes=[0];
      this.comments = [];
      this.title_to_lower=[""];
      this.date=[""];
      this.humanReadableQuery=[""];
      // Required for child functions to reach parent members
      var parent = this;
      
      
        this.sendQuery = (function(limit, skip){
        var gallery = Parse.Object.extend("gallery");
        var galquery = new Parse.Query(gallery);
        galquery.equalTo("public", true);
        if (this.nsfwFilter){
          galquery.equalTo("nsfw", false);
        }
        galquery.include("cover"); // Fetches pointer information
        galquery.include("user"); // Fetches the pointer information
        if (this.SortType == 0)
          galquery.descending("likes");
        else if (this.SortType == 1)
          galquery.ascending("likes");
        else if (this.SortType == 2)
          galquery.descending("updatedAt");
        else if (this.SortType == 3)
          galquery.ascending("updatedAt");
          
        galquery.limit(limit);
    galquery.skip(skip);
        galquery.find({
          success: function(galresults) {
              
              //alert("query complete");
              /* Fill object values */
              for (var i = 0; i < galresults.length; i++) {
                
                parent.myId[i] = galresults[i].id;
                parent.title[i] = galresults[i].get('title');
                //alert ("Received: " + parent.title[i]);
                parent.coverPic[i] = galresults[i].get("cover").get("thumb").url();
                parent.likes[i] = galresults[i].get("likes");
                parent.total_likes[i] = galresults[i].get("total_likes");
                parent.tags[i] = galresults[i].get("tags");
                parent.user[i] = galresults[i].get("user");
                parent.nsfw[i] = galresults[i].get("nsfw");
                parent.date[i] = galresults[i].updatedAt;
                parent.public[i] = galresults[i].get("public");
                parent.title_to_lower[i] = galresults[i].get("title_to_lower");
              }
              /* Query finished. Dispatch event */
              document.dispatchEvent(queryComplete);
              
              
              
            },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });
      });
     
    } 
    </script>
	</body>
</html>
